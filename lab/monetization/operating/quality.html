<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Качество</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background-color: #ffffff;
            padding: 3rem 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            color: #1a1a1a;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1rem;
            font-weight: 400;
            color: #666;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .intro {
            font-size: 1rem;
            line-height: 1.7;
            color: #2c3e50;
            margin-bottom: 3rem;
            max-width: 700px;
        }

        .intro p {
            margin-bottom: 1rem;
        }

        .section {
            margin-bottom: 4rem;
        }

        .section-title {
            font-size: 0.85rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 2rem;
            font-weight: 500;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        @media (min-width: 600px) {
            .matrix-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .matrix-card {
            padding: 1.25rem;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            background: #fafafa;
        }

        .matrix-card-title {
            font-size: 1rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
        }

        .matrix-card-item {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #2c3e50;
            margin-bottom: 0.75rem;
        }

        .matrix-card-item strong {
            color: #1a1a1a;
            font-weight: 500;
        }

        .matrix-card-item:last-child {
            margin-bottom: 0;
        }

        .chart-container {
            margin: 3rem 0;
            padding: 1.5rem;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
        }

        .chart-caption {
            font-size: 0.85rem;
            color: #888;
            font-style: italic;
            margin-top: 1rem;
            max-width: 700px;
        }

        .controls-panel {
            padding: 3rem 1rem;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            background: #fafafa;
        }

        .radio-group {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .radio-option input[type="radio"] {
            cursor: pointer;
        }

        .radio-option label {
            font-size: 0.9rem;
            color: #2c3e50;
            cursor: pointer;
        }

        .calibrator-panel {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
            padding: 1.5rem;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
        }

        @media (min-width: 900px) {
            .calibrator-panel {
                grid-template-columns: 1fr 1.5fr;
            }
        }

        .calibrator-controls {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-label {
            font-size: 0.9rem;
            color: #666;
        }

        .control-slider {
            width: 100%;
            margin-top: 0.5rem;
        }

        .control-value {
            font-size: 0.85rem;
            color: #999;
            margin-top: 0.25rem;
        }

        .calibrator-output {
            padding: 1.25rem;
            background: #fafafa;
            border-radius: 4px;
            font-size: 0.9rem;
            line-height: 1.7;
            color: #2c3e50;
        }

        .output-section {
            margin-bottom: 1.5rem;
        }

        .output-section-title {
            font-size: 0.95rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
        }

        .output-section-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #2c3e50;
        }

        .techniques-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        @media (min-width: 600px) {
            .techniques-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 900px) {
            .techniques-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .technique-card {
            padding: 1.25rem;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            background: #fafafa;
        }

        .technique-card-title {
            font-size: 1rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
        }

        .technique-card-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #2c3e50;
        }

        .standard-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 3rem;
            font-size: 0.9rem;
        }

        .standard-table th,
        .standard-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e8e8e8;
        }

        .standard-table th {
            background: #fafafa;
            font-weight: 500;
            color: #1a1a1a;
        }

        .standard-table td {
            color: #2c3e50;
        }

        .final-quote {
            font-size: 0.95rem;
            color: #999;
            font-style: italic;
            margin: 3rem 0;
            max-width: 700px;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 0.5rem;
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .back-link:hover {
            color: #1a1a1a;
        }

        .footer {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid #e8e8e8;
        }

        .footer-note {
            font-size: 0.85rem;
            color: #999;
            font-style: italic;
            margin-top: 1rem;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: #e8e8e8;
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #1f2a37;
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #1f2a37;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../../index.html" class="back-to-home">← На главную</a>

        <h1>Качество алертов</h1>
        <p class="subtitle">Лучше один точный алерт, чем десять шумных.</p>

        <div class="intro">
            <p>
                "Шум" убивает доверие: люди перестают реагировать. Когда алерт срабатывает слишком часто без реальной проблемы, команда начинает игнорировать его. Это дорого: реальная проблема может быть пропущена.
            </p>
            <p>
                "Пропуски" дороги: деньги реагируют поздно. Когда алерт не срабатывает на реальную деградацию, система ломается без предупреждения. Это дороже: потеря выручки, инциденты, паника.
            </p>
            <p>
                Цель: баланс под стоимость ошибки. Для монетизации пропуск обычно дороже шума, но не всегда. Нужно выбирать пороги и окна так, чтобы минимизировать общую стоимость ошибок.
            </p>
        </div>

        <div class="section">
            <div class="section-title">Матрица качества</div>
            <div class="matrix-grid">
                <div class="matrix-card">
                    <div class="matrix-card-title">Ложная тревога (FP)</div>
                    <div class="matrix-card-item">
                        <strong>Как выглядит:</strong> Алерт сработал, но метрика вернулась в норму сама, или это был шум/сезонность.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Цена ошибки:</strong> Потеря времени на проверку, снижение доверия к алертам, риск игнорирования реальных проблем.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Что улучшает:</strong> Confirm window — требовать подтверждения отклонения в течение нескольких дней.
                    </div>
                </div>

                <div class="matrix-card">
                    <div class="matrix-card-title">Пропуск (FN)</div>
                    <div class="matrix-card-item">
                        <strong>Как выглядит:</strong> Алерт не сработал, но система деградировала, и выручка упала.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Цена ошибки:</strong> Потеря выручки, инцидент без предупреждения, паника и хаос в диагностике.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Что улучшает:</strong> Снижение порога чувствительности и проверка по сегментам отдельно.
                    </div>
                </div>

                <div class="matrix-card">
                    <div class="matrix-card-title">Попадание (TP)</div>
                    <div class="matrix-card-item">
                        <strong>Как выглядит:</strong> Алерт сработал по делу: метрика деградировала, и это подтвердилось действием.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Цена ошибки:</strong> Нет ошибки — это успех. Но нужно быстро реагировать, иначе цена пропуска растёт.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Что улучшает:</strong> Чёткое действие и владелец — алерт без действия бесполезен.
                    </div>
                </div>

                <div class="matrix-card">
                    <div class="matrix-card-title">Молчание (TN)</div>
                    <div class="matrix-card-item">
                        <strong>Как выглядит:</strong> Тишина, и всё ок: метрика стабильна, система работает нормально.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Цена ошибки:</strong> Нет ошибки — это норма. Но нужно проверять, не слишком ли грубый порог.
                    </div>
                    <div class="matrix-card-item">
                        <strong>Что улучшает:</strong> Регулярный review порогов и baseline drift handling.
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Порог меняет поведение алерта</div>
            <div class="controls-panel">
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="sensitive" name="threshold" value="sensitive" checked>
                        <label for="sensitive">Чувствительный (много FP)</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="balanced" name="threshold" value="balanced">
                        <label for="balanced">Сбалансированный</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="coarse" name="threshold" value="coarse">
                        <label for="coarse">Грубый (много FN)</label>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <svg id="thresholdChart"></svg>
                <p class="chart-caption">Порог — это цена ошибок.</p>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Калибровщик порога</div>
            <div class="calibrator-panel">
                <div class="calibrator-controls">
                    <div class="control-group">
                        <label class="control-label">Порог чувствительности</label>
                        <input type="range" id="sensitivitySlider" class="control-slider" min="0" max="100" value="50">
                        <div class="control-value" id="sensitivityValue">50</div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Окно подтверждения (confirm)</label>
                        <input type="range" id="confirmSlider" class="control-slider" min="1" max="14" value="3">
                        <div class="control-value" id="confirmValue">3 дня</div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Cooldown (тишина после алерта)</label>
                        <input type="range" id="cooldownSlider" class="control-slider" min="0" max="14" value="0">
                        <div class="control-value" id="cooldownValue">0 дней</div>
                    </div>
                </div>
                <div class="calibrator-output" id="calibratorOutput">
                    <!-- Content will be populated by JS -->
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ROC-like trade-off, но по-человечески</div>
            <div class="chart-container">
                <svg id="rocChart"></svg>
                <p class="chart-caption">Оптимум зависит от стоимости пропуска.</p>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Техники улучшения качества</div>
            <div class="techniques-grid">
                <div class="technique-card">
                    <div class="technique-card-title">Confirm window</div>
                    <div class="technique-card-text">
                        Требовать подтверждения отклонения в течение нескольких дней. Если метрика вернулась в норму — это был шум. Если нет — реальная проблема.
                    </div>
                </div>

                <div class="technique-card">
                    <div class="technique-card-title">Cooldown</div>
                    <div class="technique-card-text">
                        Тишина после алерта: не срабатывать повторно, пока проблема не решена или не подтверждена как ложная тревога.
                    </div>
                </div>

                <div class="technique-card">
                    <div class="technique-card-title">Segment-aware thresholds</div>
                    <div class="technique-card-text">
                        Разные пороги для разных сегментов. Среднее маскирует проблемы в отдельных сегментах — проверяйте каждый отдельно.
                    </div>
                </div>

                <div class="technique-card">
                    <div class="technique-card-title">Two-signal rule</div>
                    <div class="technique-card-text">
                        Комбинация двух сигналов: алерт срабатывает только если оба сигнала отклоняются. Снижает шум, но может увеличить пропуски.
                    </div>
                </div>

                <div class="technique-card">
                    <div class="technique-card-title">Baseline drift handling</div>
                    <div class="technique-card-text">
                        Использовать долгосрочное скользящее среднее (MA long) для baseline. Система дрейфует — baseline должен дрейфовать вместе.
                    </div>
                </div>

                <div class="technique-card">
                    <div class="technique-card-title">Ownership & action</div>
                    <div class="technique-card-text">
                        Алерт без действия — это шум. Каждый алерт должен иметь владельца и чёткое действие. Если действия нет — алерт бесполезен.
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Минимальный стандарт алерта</div>
            <table class="standard-table">
                <thead>
                    <tr>
                        <th>Поле</th>
                        <th>Почему нужно</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Владелец</td>
                        <td>Кто отвечает за реакцию. Без владельца алерт игнорируется.</td>
                    </tr>
                    <tr>
                        <td>Действие</td>
                        <td>Что делать при срабатывании. Без действия алерт — это шум.</td>
                    </tr>
                    <tr>
                        <td>Окно</td>
                        <td>На каком окне смотреть метрику. Короткое окно — шум, длинное — пропуски.</td>
                    </tr>
                    <tr>
                        <td>Порог</td>
                        <td>При каком отклонении срабатывать. Баланс между шумом и пропусками.</td>
                    </tr>
                    <tr>
                        <td>Confirm</td>
                        <td>Сколько дней ждать подтверждения. Снижает ложные тревоги.</td>
                    </tr>
                    <tr>
                        <td>Cooldown</td>
                        <td>Сколько дней тишины после алерта. Предотвращает повторные срабатывания.</td>
                    </tr>
                    <tr>
                        <td>Сегменты</td>
                        <td>По каким сегментам проверять отдельно. Среднее маскирует проблемы.</td>
                    </tr>
                    <tr>
                        <td>Ссылки на разрезы</td>
                        <td>Где смотреть детализацию. Без разреза диагностика медленная.</td>
                    </tr>
                    <tr>
                        <td>Ожидаемый лаг до денег</td>
                        <td>Когда эффект проявится в выручке. Помогает планировать реакцию.</td>
                    </tr>
                    <tr>
                        <td>Критерий закрытия инцидента</td>
                        <td>Когда считать проблему решённой. Без критерия инцидент висит открытым.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <p class="final-quote">
            Качество алерта — это качество вашей реакции.
        </p>

        <div class="footer">
            <a href="./index.html" class="back-link">← Назад к Operating</a>
            <p class="footer-note">Лучше один точный алерт, чем десять шумных.</p>
        </div>
    </div>

    <script>
        // Generate data
        function generateData() {
            const n = 200;
            const data = [];
            for (let t = 1; t <= n; t++) {
                const drop = t > 120 ? 0.12 * (1 - 1 / (1 + Math.exp(-(t - 120) / 8))) : 0;
                const metric = 0.80 + 0.03 * Math.sin(t / 7) + 0.02 * Math.sin(t / 19) - drop;
                data.push({ t, metric });
            }

            // Calculate MA28 baseline
            data.forEach((d, i) => {
                const ma28Start = Math.max(0, i - 14);
                const ma28End = Math.min(n - 1, i + 14);
                const ma28Sum = d3.sum(data.slice(ma28Start, ma28End + 1), d => d.metric);
                d.baseline = ma28Sum / (ma28End - ma28Start + 1);
                d.deviation = (d.metric - d.baseline) / d.baseline;
            });

            return data;
        }

        const data = generateData();

        // Threshold chart
        function generateThresholdChart(mode) {
            const container = d3.select('#thresholdChart').node().parentElement;
            const margin = { top: 20, right: 20, bottom: 40, left: 50 };
            const width = Math.min(container.clientWidth, 800) - margin.left - margin.right;
            const height = 300 - margin.top - margin.bottom;

            d3.select('#thresholdChart').selectAll('*').remove();

            const svg = d3.select('#thresholdChart')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom);

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLinear()
                .domain([1, 200])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0.65, 0.85])
                .range([height, 0]);

            // Shaded region for real degradation
            g.append('rect')
                .attr('x', x(120))
                .attr('y', 0)
                .attr('width', x(200) - x(120))
                .attr('height', height)
                .attr('fill', '#fff5e6')
                .attr('opacity', 0.5);

            g.append('text')
                .attr('x', (x(120) + x(200)) / 2)
                .attr('y', height - 10)
                .attr('text-anchor', 'middle')
                .attr('font-size', '11px')
                .attr('fill', '#999')
                .text('реальная деградация');

            // Baseline line
            const lineBaseline = d3.line()
                .x(d => x(d.t))
                .y(d => y(d.baseline))
                .curve(d3.curveMonotoneX);

            g.append('path')
                .datum(data)
                .attr('fill', 'none')
                .attr('stroke', '#999')
                .attr('stroke-width', 1.5)
                .attr('stroke-dasharray', '3,3')
                .attr('d', lineBaseline);

            // Metric line
            const lineMetric = d3.line()
                .x(d => x(d.t))
                .y(d => y(d.metric))
                .curve(d3.curveMonotoneX);

            g.append('path')
                .datum(data)
                .attr('fill', 'none')
                .attr('stroke', '#1f2a37')
                .attr('stroke-width', 2)
                .attr('d', lineMetric);

            // Thresholds and alerts
            let threshold;
            if (mode === 'sensitive') {
                threshold = -0.02; // -2% deviation
            } else if (mode === 'balanced') {
                threshold = -0.05; // -5% deviation
            } else {
                threshold = -0.10; // -10% deviation
            }

            const alerts = [];
            data.forEach((d, i) => {
                if (d.deviation < threshold) {
                    alerts.push(d);
                }
            });

            // Alert markers
            g.selectAll('.alert')
                .data(alerts)
                .enter()
                .append('circle')
                .attr('class', 'alert')
                .attr('cx', d => x(d.t))
                .attr('cy', d => y(d.metric))
                .attr('r', 4)
                .attr('fill', mode === 'sensitive' ? '#ff6b6b' : mode === 'balanced' ? '#4ecdc4' : '#95a5a6')
                .attr('opacity', 0.8);

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).ticks(6).tickFormat(d => `t${d}`))
                .attr('font-size', '11px')
                .attr('color', '#999');

            g.append('g')
                .call(d3.axisLeft(y).ticks(5))
                .attr('font-size', '11px')
                .attr('color', '#999');

            // Labels
            g.append('text')
                .attr('x', width - 10)
                .attr('y', y(data[data.length - 1].metric) + 5)
                .attr('text-anchor', 'end')
                .attr('font-size', '10px')
                .attr('fill', '#1f2a37')
                .text('метрика');

            g.append('text')
                .attr('x', width - 10)
                .attr('y', y(data[data.length - 1].baseline) + 5)
                .attr('text-anchor', 'end')
                .attr('font-size', '10px')
                .attr('fill', '#999')
                .text('baseline (MA28)');
        }

        // Initial render
        generateThresholdChart('sensitive');

        // Radio buttons handler
        document.querySelectorAll('input[name="threshold"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                generateThresholdChart(e.target.value);
            });
        });

        // Calibrator
        function updateCalibrator() {
            const sensitivity = parseInt(document.getElementById('sensitivitySlider').value);
            const confirm = parseInt(document.getElementById('confirmSlider').value);
            const cooldown = parseInt(document.getElementById('cooldownSlider').value);

            // Heuristic: precision grows with confirm+cooldown, falls with sensitivity
            // recall grows with sensitivity, falls with confirm
            const precisionScore = (confirm + cooldown) / 28 - sensitivity / 200;
            const recallScore = sensitivity / 100 - confirm / 28;

            let precisionLevel, recallLevel;
            if (precisionScore > 0.3) precisionLevel = 'высокая';
            else if (precisionScore > 0) precisionLevel = 'средняя';
            else precisionLevel = 'низкая';

            if (recallScore > 0.3) recallLevel = 'высокая';
            else if (recallScore > 0) recallLevel = 'средняя';
            else recallLevel = 'низкая';

            let recommendation = '';
            if (precisionLevel === 'низкая' && recallLevel === 'низкая') {
                recommendation = 'Увеличьте confirm window и cooldown для снижения шума. Увеличьте чувствительность для снижения пропусков.';
            } else if (precisionLevel === 'низкая') {
                recommendation = 'Увеличьте confirm window и cooldown для снижения шума. Текущая чувствительность хороша для recall.';
            } else if (recallLevel === 'низкая') {
                recommendation = 'Увеличьте чувствительность для снижения пропусков. Текущие confirm и cooldown хороши для precision.';
            } else {
                recommendation = 'Баланс хорош. Мониторьте качество алертов и корректируйте при необходимости.';
            }

            document.getElementById('calibratorOutput').innerHTML = `
                <div class="output-section">
                    <div class="output-section-title">Ожидаемая точность (precision)</div>
                    <div class="output-section-text">${precisionLevel}</div>
                </div>
                <div class="output-section">
                    <div class="output-section-title">Ожидаемая полнота (recall)</div>
                    <div class="output-section-text">${recallLevel}</div>
                </div>
                <div class="output-section">
                    <div class="output-section-title">Рекомендация</div>
                    <div class="output-section-text">${recommendation}</div>
                </div>
            `;
        }

        document.getElementById('sensitivitySlider').addEventListener('input', (e) => {
            document.getElementById('sensitivityValue').textContent = e.target.value;
            updateCalibrator();
        });

        document.getElementById('confirmSlider').addEventListener('input', (e) => {
            document.getElementById('confirmValue').textContent = `${e.target.value} ${e.target.value === 1 ? 'день' : 'дней'}`;
            updateCalibrator();
        });

        document.getElementById('cooldownSlider').addEventListener('input', (e) => {
            document.getElementById('cooldownValue').textContent = `${e.target.value} ${e.target.value === 1 ? 'день' : 'дней'}`;
            updateCalibrator();
        });

        updateCalibrator();

        // ROC chart
        function generateROCChart() {
            const container = d3.select('#rocChart').node().parentElement;
            const margin = { top: 20, right: 20, bottom: 40, left: 50 };
            const width = Math.min(container.clientWidth, 800) - margin.left - margin.right;
            const height = 300 - margin.top - margin.bottom;

            d3.select('#rocChart').selectAll('*').remove();

            const svg = d3.select('#rocChart')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom);

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Fixed points for different configurations
            const points = [
                { fp: 0.85, fn: 0.05, label: 'слишком шумно' },
                { fp: 0.70, fn: 0.10, label: '' },
                { fp: 0.50, fn: 0.15, label: '' },
                { fp: 0.35, fn: 0.20, label: 'разумно' },
                { fp: 0.20, fn: 0.30, label: '' },
                { fp: 0.10, fn: 0.45, label: '' },
                { fp: 0.05, fn: 0.60, label: '' },
                { fp: 0.02, fn: 0.80, label: 'слишком поздно' }
            ];

            const x = d3.scaleLinear()
                .domain([0, 1])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, 1])
                .range([height, 0]);

            // Scatter points
            g.selectAll('.point')
                .data(points)
                .enter()
                .append('circle')
                .attr('class', 'point')
                .attr('cx', d => x(d.fp))
                .attr('cy', d => y(d.fn))
                .attr('r', 5)
                .attr('fill', d => {
                    if (d.label === 'слишком шумно') return '#ff6b6b';
                    if (d.label === 'слишком поздно') return '#95a5a6';
                    if (d.label === 'разумно') return '#4ecdc4';
                    return '#999';
                })
                .attr('opacity', 0.8);

            // Labels
            g.selectAll('.label')
                .data(points.filter(d => d.label))
                .enter()
                .append('text')
                .attr('class', 'label')
                .attr('x', d => x(d.fp))
                .attr('y', d => y(d.fn) - 10)
                .attr('text-anchor', 'middle')
                .attr('font-size', '11px')
                .attr('fill', '#2c3e50')
                .text(d => d.label);

            // Axes
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).ticks(5).tickFormat(d3.format('.1f')))
                .attr('font-size', '11px')
                .attr('color', '#999');

            g.append('g')
                .call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.1f')))
                .attr('font-size', '11px')
                .attr('color', '#999');

            // Axis labels
            g.append('text')
                .attr('x', width / 2)
                .attr('y', height + 35)
                .attr('text-anchor', 'middle')
                .attr('font-size', '11px')
                .attr('fill', '#666')
                .text('шум (FP rate)');

            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', -35)
                .attr('text-anchor', 'middle')
                .attr('font-size', '11px')
                .attr('fill', '#666')
                .text('пропуски (FN rate)');
        }

        generateROCChart();

        // Responsive resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const mode = document.querySelector('input[name="threshold"]:checked').value;
                generateThresholdChart(mode);
                generateROCChart();
            }, 250);
        });
    </script>
    <script>
        (function () {
            const current = window.location.pathname.replace(/\/$/, "");
            links.forEach(a => {
                const href = a.getAttribute("href");
                if (!href) return;
                const normalized = href.replace(/\/$/, "");
                if (normalized === current || current.endsWith(normalized)) {
                    a.classList.add("active");
                    a.setAttribute("aria-current", "page");
                    const section = a.closest(".nav-section");
                    if (section) section.classList.add("active-section");
                }
            });
        })();
    </script>
</body>
</html>

