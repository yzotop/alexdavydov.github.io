<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anatomy of an Experiment</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background-color: #ffffff;
            padding: 3rem 1rem;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            color: #1a1a1a;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1rem;
            font-weight: 400;
            color: #666;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .lead {
            font-size: 0.95rem;
            color: #888;
            margin-bottom: 3rem;
            max-width: 700px;
        }

        .lead p {
            margin-bottom: 1rem;
        }

        .disclosure-panel {
            padding: 1.5rem;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            margin-bottom: 3rem;
            max-width: 700px;
        }

        .disclosure-title {
            font-size: 0.9rem;
            color: #999;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .disclosure-panel p {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #2c3e50;
            margin-bottom: 0.75rem;
        }

        .anchor-sentence {
            font-size: 0.95rem;
            color: #999;
            font-style: italic;
            margin-top: 2rem;
            margin-bottom: 4rem;
            max-width: 700px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 65% 35%;
            gap: 3rem;
            margin-bottom: 4rem;
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
        }

        .figure-container {
            padding: 1.5rem;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
        }

        .chart-panel {
            margin-bottom: 1.5rem;
        }

        .chart-panel:last-child {
            margin-bottom: 0;
        }

        .panel-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .story-rail {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .story-card {
            padding: 1.25rem;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            background: #fafafa;
        }

        .story-card-title {
            font-size: 1rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
        }

        .story-card p {
            font-size: 0.9rem;
            line-height: 1.7;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .story-card p:last-child {
            margin-bottom: 0;
        }

        .story-note {
            font-size: 0.85rem;
            color: #888;
            font-style: italic;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e8e8e8;
        }

        .checklist-panel {
            padding: 1.5rem;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            margin-bottom: 3rem;
            max-width: 700px;
        }

        .checklist-title {
            font-size: 0.9rem;
            color: #999;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .checklist-panel p {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #2c3e50;
            margin-bottom: 0.75rem;
        }

        .checklist-panel p:last-child {
            margin-bottom: 0;
            font-style: italic;
            color: #888;
            margin-top: 1rem;
        }

        .axis {
            font-size: 11px;
            fill: #999;
            font-weight: 400;
        }

        .axis .domain {
            display: none;
        }

        .axis .tick line {
            stroke: #e8e8e8;
            stroke-width: 1;
        }

        .line {
            fill: none;
            stroke-width: 2;
        }

        .line-pressure {
            stroke: #666;
        }

        .line-mechanic {
            stroke: #999;
            stroke-dasharray: 4, 4;
        }

        .line-revenue {
            stroke: #1f2a37;
        }

        .event-line {
            stroke: #ccc;
            stroke-width: 1;
            stroke-dasharray: 2, 2;
            opacity: 0.7;
        }

        .silence-region {
            fill: #f0f0f0;
            opacity: 0.4;
        }

        .silence-label {
            font-size: 10px;
            fill: #999;
            font-weight: 400;
        }

        .marker-label {
            font-size: 10px;
            fill: #999;
            font-weight: 400;
        }

        .axis-label {
            font-size: 11px;
            fill: #999;
            font-weight: 400;
        }

        .chart-caption {
            font-size: 0.85rem;
            color: #888;
            font-style: italic;
            margin-top: 1.5rem;
            max-width: 700px;
        }

        .interpretation {
            font-size: 1rem;
            line-height: 1.7;
            color: #2c3e50;
            margin: 3rem 0;
            max-width: 700px;
        }

        .interpretation strong {
            font-weight: 600;
            color: #1a1a1a;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 0.5rem;
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .back-link:hover {
            color: #1a1a1a;
        }

        .back-link.secondary {
            font-size: 0.8rem;
            color: #999;
            margin-left: 1rem;
        }

        .footer-note {
            font-size: 0.85rem;
            color: #999;
            font-style: italic;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../../index.html" class="back-to-home">← На главную</a>

        
        <h1>Anatomy of an Experiment</h1>
        <p class="subtitle">Эксперимент как траектория.</p>

        <div class="lead">
            <p>
                Мы анонимизируем всё. Показываем форму динамики.
            </p>
            <p>
                Цель — научиться читать механизм раньше, чем выручку.
            </p>
        </div>

        <div class="disclosure-panel">
            <div class="disclosure-title">Формат и ограничения</div>
            <p>Нет названий фичей и внутренних терминов.</p>
            <p>Нет абсолютных значений и точных процентов.</p>
            <p>Все метрики нормированы (индексы).</p>
            <p>Показываем форму причинно-следственной цепочки.</p>
        </div>

        <p class="anchor-sentence">
            Сначала ломается механизм. Потом — итог.
        </p>

        <div class="main-layout">
            <div class="figure-container">
                <div class="chart-panel">
                    <div class="panel-label">вмешательство / давление</div>
                    <svg id="chart1"></svg>
                </div>
                <div class="chart-panel">
                    <div class="panel-label">механика</div>
                    <svg id="chart2"></svg>
                </div>
                <div class="chart-panel">
                    <div class="panel-label">итог (выручка)</div>
                    <svg id="chart3"></svg>
                </div>
                <p class="chart-caption">
                    Форма важнее цифр: давление растёт → механика падает → деньги реагируют позже.
                </p>
            </div>

            <div class="story-rail">
                <div class="story-card">
                    <div class="story-card-title">1) Вмешательство</div>
                    <p>
                        Мы увеличили интенсивность монетизации (обезличенно). Это выглядит как рост давления.
                    </p>
                    <p>
                        В отчёте ожидается рост итога.
                    </p>
                </div>

                <div class="story-card">
                    <div class="story-card-title">2) Ранний сигнал</div>
                    <p>
                        Сначала реагирует механика: конверсия в показ/эффективность контакта начинает падать.
                    </p>
                    <p>
                        Это видно раньше, чем в деньгах.
                    </p>
                </div>

                <div class="story-card">
                    <div class="story-card-title">3) Ловушка вывода</div>
                    <p>
                        В окне тишины итог почти не меняется, и кажется, что всё хорошо.
                    </p>
                    <p>
                        Но это компенсация: система 'держит' итог, пока ухудшается механизм.
                    </p>
                </div>

                <div class="story-card">
                    <div class="story-card-title">4) Итог</div>
                    <p>
                        После лагов итог начинает реагировать: ухудшение проявляется в выручке.
                    </p>
                    <p>
                        Это не 'внезапное падение', а запоздалый эффект траектории.
                    </p>
                </div>

                <p class="story-note">
                    Вывод: ранние сигналы важнее позднего итога.
                </p>
            </div>
        </div>

        <div class="checklist-panel">
            <div class="checklist-title">Чеклист чтения эксперимента</div>
            <p>Где воздействовали: давление / порядок / время?</p>
            <p>Какая ранняя механика должна реагировать первой?</p>
            <p>Где ожидается тишина (лаг)?</p>
            <p>Какой признак говорит: режим стал другим?</p>
            <p>Не оптимизируйте по отчёту — оптимизируйте по механике.</p>
        </div>

        <p class="interpretation">
            Эта форма повторяется во многих экспериментах: рост давления сначала выглядит прибыльным.
        </p>

        <p class="interpretation">
            Но если падает механика, то итог часто реагирует позже — и это становится 'сюрпризом'.
        </p>

        <p class="interpretation">
            <strong>Эксперимент — это траектория причин, а не число в таблице.</strong>
        </p>

        <div>
            <a href="./index.html" class="back-link">← Назад к экспериментам</a>
            <p class="footer-note">Экспертиза — это узнавание формы.</p>
        </div>
    </div>

    <script>
        function clamp(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        // Generate deterministic synthetic data
        const data = [];
        for (let t = 1; t <= 140; t++) {
            // Pressure index
            const pre = 100 + 1.2 * Math.sin(t / 18);
            const step = 18 * (1 / (1 + Math.exp(-(t - 35) / 2)));
            const drift = 6 * (1 / (1 + Math.exp(-(t - 60) / 8)));
            const P = clamp(pre + step + drift, 85, 130);

            // Mechanic index
            const laggedPressure = t - 10 >= 1 ? 
                (() => {
                    const t_lag = t - 10;
                    const pre_lag = 100 + 1.2 * Math.sin(t_lag / 18);
                    const step_lag = 18 * (1 / (1 + Math.exp(-(t_lag - 35) / 2)));
                    const drift_lag = 6 * (1 / (1 + Math.exp(-(t_lag - 60) / 8)));
                    return clamp(pre_lag + step_lag + drift_lag, 85, 130);
                })() : 100;
            const deter = 0.35 * (1 / (1 + Math.exp(-(t - 45) / 6)));
            const M_base = 102 + 1.0 * Math.sin(t / 22) + 0.6 * Math.sin(t / 9);
            const M = M_base - 0.18 * (laggedPressure - 100) - 12 * deter;
            const M_clamped = clamp(M, 70, 115);

            // Revenue index
            const comp = 8 * (1 / (1 + Math.exp(-(t - 40) / 7)));
            const fatigue = 16 * (1 / (1 + Math.exp(-(t - 85) / 6)));
            const R_base = 100 + 0.8 * Math.sin(t / 20);
            const R = R_base + 0.35 * (P - 100) - 0.55 * (100 - M_clamped) + comp - fatigue;
            const R_clamped = clamp(R, 70, 125);

            data.push({ t, P, M: M_clamped, R: R_clamped });
        }

        // Normalize so t=1 equals 100
        const P1 = data[0].P;
        const M1 = data[0].M;
        const R1 = data[0].R;
        data.forEach(d => {
            d.Pidx = 100 * d.P / P1;
            d.Midx = 100 * d.M / M1;
            d.Ridx = 100 * d.R / R1;
        });

        // Chart dimensions
        const chartWidth = 760;
        const margin = { top: 20, right: 80, bottom: 40, left: 50 };
        const panelHeight = 120;
        const height = panelHeight + margin.top + margin.bottom;

        const xScale = d3.scaleLinear()
            .domain([1, 140])
            .range([0, chartWidth - margin.left - margin.right]);

        const yScale = d3.scaleLinear()
            .domain([70, 130])
            .range([panelHeight, 0]);

        const line = d3.line()
            .x(d => xScale(d.t))
            .y(d => yScale(d.value))
            .curve(d3.curveMonotoneX);

        // Chart 1: Pressure
        const svg1 = d3.select("#chart1")
            .attr("width", chartWidth)
            .attr("height", height);

        const g1 = svg1.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Event line at t=35
        g1.append("line")
            .attr("class", "event-line")
            .attr("x1", xScale(35))
            .attr("x2", xScale(35))
            .attr("y1", 0)
            .attr("y2", panelHeight);

        g1.append("text")
            .attr("class", "marker-label")
            .attr("x", xScale(35) + 3)
            .attr("y", 12)
            .text("вмешательство");

        // Line
        const pressureData = data.map(d => ({ t: d.t, value: d.Pidx }));
        g1.append("path")
            .datum(pressureData)
            .attr("class", "line line-pressure")
            .attr("d", line);

        // Label
        const last1 = pressureData[pressureData.length - 1];
        g1.append("text")
            .attr("class", "axis-label")
            .attr("x", xScale(last1.t) + 5)
            .attr("y", yScale(last1.value) - 5)
            .text("интенсивность");

        // Axes (only on last chart, but prepare here)
        const xAxis = d3.axisBottom(xScale)
            .ticks(6)
            .tickValues([1, 35, 60, 85, 110, 140])
            .tickSize(4)
            .tickPadding(8);

        const yAxis = d3.axisLeft(yScale)
            .ticks(3)
            .tickValues([70, 100, 130])
            .tickSize(4)
            .tickPadding(8);

        g1.append("g")
            .attr("class", "axis")
            .call(yAxis);

        // Chart 2: Mechanic
        const svg2 = d3.select("#chart2")
            .attr("width", chartWidth)
            .attr("height", height);

        const g2 = svg2.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Event line at t=35
        g2.append("line")
            .attr("class", "event-line")
            .attr("x1", xScale(35))
            .attr("x2", xScale(35))
            .attr("y1", 0)
            .attr("y2", panelHeight);

        // Silence region
        g2.append("rect")
            .attr("class", "silence-region")
            .attr("x", xScale(45))
            .attr("y", 0)
            .attr("width", xScale(80) - xScale(45))
            .attr("height", panelHeight);

        g2.append("text")
            .attr("class", "silence-label")
            .attr("x", xScale(62.5))
            .attr("y", 12)
            .attr("text-anchor", "middle")
            .text("тишина: деньги молчат");

        // Event line at t=85
        g2.append("line")
            .attr("class", "event-line")
            .attr("x1", xScale(85))
            .attr("x2", xScale(85))
            .attr("y1", 0)
            .attr("y2", panelHeight);

        g2.append("text")
            .attr("class", "marker-label")
            .attr("x", xScale(85) + 3)
            .attr("y", 12)
            .text("итог реагирует");

        // Line
        const mechanicData = data.map(d => ({ t: d.t, value: d.Midx }));
        g2.append("path")
            .datum(mechanicData)
            .attr("class", "line line-mechanic")
            .attr("d", line);

        // Label
        const last2 = mechanicData[mechanicData.length - 1];
        g2.append("text")
            .attr("class", "axis-label")
            .attr("x", xScale(last2.t) + 5)
            .attr("y", yScale(last2.value) - 5)
            .text("механика");

        g2.append("g")
            .attr("class", "axis")
            .call(yAxis);

        // Chart 3: Revenue
        const svg3 = d3.select("#chart3")
            .attr("width", chartWidth)
            .attr("height", height);

        const g3 = svg3.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Event line at t=35
        g3.append("line")
            .attr("class", "event-line")
            .attr("x1", xScale(35))
            .attr("x2", xScale(35))
            .attr("y1", 0)
            .attr("y2", panelHeight);

        // Silence region
        g3.append("rect")
            .attr("class", "silence-region")
            .attr("x", xScale(45))
            .attr("y", 0)
            .attr("width", xScale(80) - xScale(45))
            .attr("height", panelHeight);

        // Event line at t=85
        g3.append("line")
            .attr("class", "event-line")
            .attr("x1", xScale(85))
            .attr("x2", xScale(85))
            .attr("y1", 0)
            .attr("y2", panelHeight);

        // Line
        const revenueData = data.map(d => ({ t: d.t, value: d.Ridx }));
        g3.append("path")
            .datum(revenueData)
            .attr("class", "line line-revenue")
            .attr("d", line);

        // Label
        const last3 = revenueData[revenueData.length - 1];
        g3.append("text")
            .attr("class", "axis-label")
            .attr("x", xScale(last3.t) + 5)
            .attr("y", yScale(last3.value) - 5)
            .text("итог (выручка)");

        // X-axis only on bottom chart
        g3.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0,${panelHeight})`)
            .call(xAxis);

        g3.append("g")
            .attr("class", "axis")
            .call(yAxis);

        g3.append("text")
            .attr("class", "axis-label")
            .attr("x", (chartWidth - margin.left - margin.right) / 2)
            .attr("y", panelHeight + 35)
            .attr("text-anchor", "middle")
            .text("t");
    </script>
    <script>
        (function () {
            const current = window.location.pathname.replace(/\/$/, "");
            links.forEach(a => {
                const href = a.getAttribute("href");
                if (!href) return;
                const normalized = href.replace(/\/$/, "");
                if (normalized === current || current.endsWith(normalized)) {
                    a.classList.add("active");
                    a.setAttribute("aria-current", "page");
                    const section = a.closest(".nav-section");
                    if (section) section.classList.add("active-section");
                }
            });
        })();
    </script>
</body>
</html>

