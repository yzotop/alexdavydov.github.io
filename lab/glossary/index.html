<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Глоссарий аналитики</title>
    <link rel="stylesheet" href="/assets/base.css">
    <link rel="stylesheet" href="../assets/css/links.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background-color: #ffffff;
            padding: 3rem 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 1.5rem;
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .back-link:hover {
            color: #1a1a1a;
        }

        h1 {
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
            color: #1a1a1a;
        }

        .subtitle {
            font-size: 1rem;
            font-weight: 400;
            color: #666;
            margin-bottom: 2rem;
            font-style: italic;
            max-width: 700px;
        }

        .search-box {
            margin-bottom: 3rem;
        }

        .search-input {
            width: 100%;
            max-width: 500px;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            font-size: 0.95rem;
            color: #1a1a1a;
            background: #ffffff;
        }

        .search-input:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .term-card {
            margin-bottom: 3rem;
            padding: 1.5rem;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
        }

        .term-card.hidden {
            display: none;
        }

        .term-card h2 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 0.6rem;
            color: #1a1a1a;
            scroll-margin-top: 2rem;
        }

        .term-badges {
            display: inline-flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin: 0 0 1rem;
        }

        .term-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.22rem 0.55rem;
            border-radius: 999px;
            font-size: 0.78rem; /* ~12px */
            line-height: 1.2;
            border: 1px solid rgba(37, 99, 235, 0.22);
            background: rgba(37, 99, 235, 0.06);
            color: rgba(37, 99, 235, 0.92);
            font-weight: 500;
            white-space: nowrap;
        }

        .term-related {
            display: inline-flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-top: 0.25rem;
        }

        .term-related-chip {
            display: inline-flex;
            align-items: center;
            padding: 0.18rem 0.5rem;
            border-radius: 999px;
            font-size: 0.75rem;
            line-height: 1.2;
            border: 1px solid rgba(17, 24, 39, 0.14);
            background: rgba(17, 24, 39, 0.03);
            color: #6b7280;
            cursor: pointer;
            user-select: none;
        }

        .term-related-chip:hover {
            border-color: rgba(37, 99, 235, 0.35);
            background: rgba(37, 99, 235, 0.06);
            color: rgba(37, 99, 235, 0.92);
        }

        .term-section {
            margin-bottom: 1rem;
        }

        /* Related terms: chips-only meta block (no title label) */
        .term-section--related {
            margin-top: 1rem;
        }

        .term-section--related .term-section-title {
            display: none;
        }

        .term-section:last-child {
            margin-bottom: 0;
        }

        .term-section-title {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .term-section-content {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #1a1a1a;
        }

        .term-section-content strong {
            font-weight: 600;
        }

        .footer-note {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
            font-size: 0.85rem;
            color: #666;
        }

        .footer-note a {
            color: #1a1a1a;
            text-decoration: none;
            border-bottom: 1px solid #1a1a1a;
        }

        .footer-note a:hover {
            border-color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">← На главную</a>
        <a href="../index.html" class="back-link" style="margin-left: 1rem;">← К каталогу</a>

        <h1>Глоссарий аналитики</h1>
        <p class="subtitle">Единый язык проекта: термины и метрики без дублирования определений</p>

        <div class="search-box">
            <input type="text" id="search-input" class="search-input" placeholder="Поиск по терминам...">
        </div>

        <div id="terms-container">
            <div class="term-card" data-term="requests" data-tags="Монетизация, Ad Tech, Воронка" data-related-terms="fill-rate,show-rate,revenue-decomposition">
                <h2 id="requests">Запросы (Requests)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Объём входящего спроса / попыток получить рекламу (в обучающих калькуляторах может быть индексом).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать, что рост Requests автоматически означает рост выручки.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Requests — верх воронки. Деньги появляются только если дальше сохраняются Fill/Show и цена.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда рост Requests сопровождается падением Fill или Show rate.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">fill-rate, show-rate, revenue-decomposition</div>
                </div>
            </div>

            <div class="term-card" data-term="responses" data-tags="Монетизация, Ad Tech, Воронка" data-related-terms="fill-rate,show-rate,shows">
                <h2 id="responses">Ответы (Responses)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Успешные ответы на requests (в контексте рекламного запроса/ответа).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Путать responses с показами.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Responses — это «разрешение/готовность» системы продолжить воронку, но не факт показа.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда responses стабильны, но падают показы/монетизируемые показы ниже по воронке.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">fill-rate, show-rate, shows</div>
                </div>
            </div>

            <div class="term-card" data-term="fill-rate" data-tags="Монетизация, Ad Tech, Delivery" data-related-terms="requests,responses,show-rate">
                <h2 id="fill-rate">Коэффициент заполнения (Fill rate)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Доля ответов: <strong>fill rate = responses / requests</strong>.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать fill rate «качеством рекламы» или «денежной метрикой».</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Fill rate — это пропускная способность верхней части воронки: насколько спрос реально превращается в возможность показа.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда fill растёт, но show rate падает (эффект «разрешили больше, показали меньше»).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">requests, responses, show-rate</div>
                </div>
            </div>

            <div class="term-card" data-term="shows" data-tags="Монетизация, Ad Tech, Delivery" data-related-terms="monetized-shows,show-rate">
                <h2 id="shows">Показы (Shows)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Фактические показы (в учебных моделях — промежуточный уровень между responses и monet shows).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Смешивать shows и monet shows.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Shows — это объём экспозиции, но деньги зависят от монетизируемой части и цены.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда растут shows за счёт «плохих» показов, которые не монетизируются.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">monetized-shows, show-rate</div>
                </div>
            </div>

            <div class="term-card" data-term="monetized-shows" data-tags="Монетизация, Ad Tech, Revenue" data-related-terms="show-rate,pressure,revenue">
                <h2 id="monetized-shows">Монетизируемые показы (Monetized shows)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Показы, которые считаются монетизируемыми и участвуют в выручке.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать, что любые показы = деньги.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Это главный «объёмный» множитель выручки вместе с CPM.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда рост monet shows вызван ростом давления и ухудшает пользовательские метрики (вне учебной модели).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">show-rate, pressure, revenue</div>
                </div>
            </div>

            <div class="term-card" data-term="show-rate" data-tags="Монетизация, Ad Tech, Delivery" data-related-terms="fill-rate,cpm,revenue-decomposition">
                <h2 id="show-rate">Коэффициент показа (Show rate)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Доля монетизируемых показов от ответов: <strong>show rate = monetized_shows / responses</strong>.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать show rate «частью fill rate» или путать знаменатель.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Show rate — это эффективность превращения "responses" в монетизацию. Часто именно здесь «съедается» эффект.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда show rate растёт, но CPM падает (можно получить больше показов, но дешевле).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">fill-rate, cpm, revenue-decomposition</div>
                </div>
            </div>

            <div class="term-card" data-term="cpm" data-tags="Монетизация, Pricing" data-related-terms="revenue,price-vs-volume,saturation">
                <h2 id="cpm">CPM (Cost Per Mille)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Цена за 1000 монетизируемых показов.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Рост CPM = рост выручки.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">CPM — это цена, а не деньги. Выручка = цена × объём. Цена может расти при падении объёма и наоборот.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда CPM растёт на сужении инвентаря и падают monetized shows.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">revenue, price-vs-volume, saturation</div>
                </div>
            </div>

            <div class="term-card" data-term="revenue" data-tags="Монетизация, Метрики" data-related-terms="revenue-decomposition,control-vs-test,pressure">
                <h2 id="revenue">Выручка (Revenue)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Деньги, получаемые системой от монетизации.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Читать revenue без декомпозиции и без воронки.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Revenue — итог мультипликативной цепочки. Чтобы понять причину, нужно разложить на множители: объём и цену.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда итог стабилен, но внутри компенсируются противоположные эффекты (одна метрика растёт, другая падает).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">revenue-decomposition, control-vs-test, pressure</div>
                </div>
            </div>

            <div class="term-card" data-term="revenue-decomposition" data-tags="Монетизация, Метод" data-related-terms="control-vs-test,revenue,price-vs-volume">
                <h2 id="revenue-decomposition">Декомпозиция выручки (Revenue decomposition)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Разложение выручки на вклад факторов (объёмные шаги воронки + цена).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать, что "главная метрика" объясняет сама себя.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Если есть итоговый эффект, он обязан быть объясним вкладом шагов. Иначе это шум/ошибка/плохая модель.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда вклад факторов считают на разных базах/окнах или смешивают знаменатели.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">control-vs-test, revenue, price-vs-volume</div>
                </div>
            </div>

            <div class="term-card" data-term="control-vs-test" data-tags="Эксперименты, Метод" data-related-terms="revenue-decomposition,rollout,mechanism">
                <h2 id="control-vs-test">Контроль vs тест (Control vs test)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Сравнение контрольной и тестовой группы как разбор причин эффекта, а не только фиксация "+/-".</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Останавливаться на "значимо/незначимо".</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Нужно разложить итог на вклад шагов и понять механизм: где именно возник эффект.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда в агрегате эффект есть, а в сегментах — конфликт (Симпсон).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">revenue-decomposition, rollout, mechanism</div>
                </div>
            </div>

            <div class="term-card" data-term="rollout" data-tags="Эксперименты, Rollout" data-related-terms="control-vs-test,revenue-decomposition,mechanism">
                <h2 id="rollout">Раскатка (Rollout)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Раскатка изменения на 100% трафика.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Линейно переносить эффект без учёта доли трафика и механизма.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Проекция на 100% — это масштабирование эффекта с учётом текущей доли и базового уровня.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда сравнивают несколько тестов и "раскатывают всё сразу" (в реальности выбирают один вариант).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">control-vs-test, revenue-decomposition, mechanism</div>
                </div>
            </div>

            <div class="term-card" data-term="pressure" data-tags="Монетизация, Ad Tech, Pressure" data-related-terms="saturation,monetized-shows,revenue">
                <h2 id="pressure">Давление рекламы (Ad Pressure)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Интенсивность показа рекламы пользователю в единицу времени или на единицу контента. Не количество рекламы, а частота/плотность экспозиции.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать pressure = ad load (количество рекламных блоков на странице).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Pressure — это скорость «насыщения» пользователя рекламой. Высокое pressure может дать краткосрочный рост показов, но снижает CTR и увеличивает усталость.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда pressure растёт, а выручка стабильна: это может означать, что система уже в зоне насыщения и дальнейший рост pressure ухудшит метрики.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">saturation, monetized-shows, revenue</div>
                </div>
            </div>

            <div class="term-card" data-term="saturation" data-tags="Монетизация, Saturation" data-related-terms="pressure,price-vs-volume,revenue-decomposition">
                <h2 id="saturation">Насыщение (Saturation)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Состояние системы, когда дальнейшее увеличение входного параметра (pressure, demand, frequency) не даёт пропорционального роста результата или даже снижает его.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать, что «больше всегда лучше» и линейно экстраполировать эффекты.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Saturation — это сигнал, что система достигла предела эффективности по данному каналу. Нужно искать другой механизм роста или оптимизировать существующий.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда saturation скрыта за компенсацией: например, рост pressure даёт рост показов, но падает CTR, и итоговая выручка не меняется — это уже насыщение.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">pressure, price-vs-volume, revenue-decomposition</div>
                </div>
            </div>

            <div class="term-card" data-term="price-vs-volume" data-tags="Монетизация, Pricing" data-related-terms="cpm,revenue,elasticity,saturation">
                <h2 id="price-vs-volume">Компромисс цена-объём (Price vs Volume trade-off)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Обратная зависимость между ценой (CPM) и объёмом (monetized shows): рост одного обычно приводит к падению другого.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Оптимизировать только цену или только объём, не видя их взаимосвязи.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Выручка = цена × объём. Оптимальная точка — это баланс, где произведение максимально, а не где один из множителей максимален.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда система в зоне насыщения: рост CPM через floor/constraints может дать краткосрочный рост выручки, но критически снизить объём и долгосрочную устойчивость.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">cpm, revenue, elasticity, saturation</div>
                </div>
            </div>

            <div class="term-card" data-term="elasticity" data-tags="Монетизация, Pricing, Sensitivity" data-related-terms="price-vs-volume,cpm,saturation">
                <h2 id="elasticity">Эластичность (Elasticity)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Чувствительность объёма к изменению цены: на сколько процентов меняется объём при изменении цены на 1%.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать elasticity постоянной величиной или применять одно значение для всех сегментов и режимов.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Elasticity показывает, в какой зоне находится система: эластичная (объём сильно реагирует на цену) или неэластичная (объём стабилен). Это определяет стратегию оптимизации.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда elasticity меняется в зависимости от базового уровня pressure, saturation или market regime, а аналитик использует старое значение.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">price-vs-volume, cpm, saturation</div>
                </div>
            </div>

            <div class="term-card" data-term="risk-contribution" data-tags="Финансы / Риск, Portfolio" data-related-terms="stress-scenario">
                <h2 id="risk-contribution">Вклад в риск (Risk contribution)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Вклад конкретного актива или фактора в общий риск портфеля или системы. Показывает, какая доля дисперсии результата объясняется этим активом.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать, что риск пропорционален весу: актив с 50% веса не обязательно даёт 50% риска.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Risk contribution показывает реальную концентрацию риска. Если один актив даёт 70% вклада в риск при 40% веса — это сигнал о дисбалансе.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда risk contribution считается без учёта корреляций между активами или когда система меняет режим (market regime change).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">stress-scenario</div>
                </div>
            </div>

            <div class="term-card" data-term="stress-scenario" data-tags="Финансы / Риск, Stress-testing" data-related-terms="risk-contribution">
                <h2 id="stress-scenario">Стресс-сценарий (Stress scenario)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Смоделированный шок на систему: одновременное изменение нескольких параметров, имитирующее реальный кризис или экстремальное событие.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Считать stress scenario «маловероятным событием» и игнорировать его при принятии решений.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Stress scenario показывает уязвимость системы к конкретному типу шока. Если портфель теряет >2.5% в сценарии — это сигнал о концентрации риска.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда stress scenario не покрывает реальные режимы системы или когда система меняется быстрее, чем обновляются сценарии.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">risk-contribution</div>
                </div>
            </div>

            <div class="term-card" data-term="mechanism" data-tags="Метод, Mechanism" data-related-terms="revenue-decomposition,control-vs-test,pressure">
                <h2 id="mechanism">Механизм (Mechanism)</h2>
                <div class="term-section">
                    <div class="term-section-title">Что это</div>
                    <div class="term-section-content">Причинно-следственная цепочка, объясняющая, почему система ведёт себя определённым образом. Не просто корреляция, а понимание «как работает».</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Типичная ошибка</div>
                    <div class="term-section-content">Останавливаться на метриках и графиках, не объясняя механизм: «CPM вырос, значит хорошо».</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Как правильно читать</div>
                    <div class="term-section-content">Механизм — это связка: изменение входного параметра → изменение промежуточных состояний → изменение результата. Без механизма нельзя предсказать эффект в новых условиях.</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Когда вводит в заблуждение</div>
                    <div class="term-section-content">Когда механизм работает только в определённом режиме (например, при низком pressure), а решение применяется в другом режиме (высокое pressure).</div>
                </div>
                <div class="term-section">
                    <div class="term-section-title">Связанные темы</div>
                    <div class="term-section-content">revenue-decomposition, control-vs-test, pressure</div>
                </div>
            </div>
        </div>

        <div class="footer-note">
            Источник: <a href="/GLOSSARY.md">GLOSSARY.md</a>
        </div>
    </div>

    <script>
        // Simple search functionality
        const searchInput = document.getElementById('search-input');
        const termsContainer = document.getElementById('terms-container');

        // Sort terms alphabetically by RU title (EN in parentheses ignored).
        // Latin-leading titles (e.g., CPM) are placed after Cyrillic.
        if (termsContainer) {
            const cards = Array.from(termsContainer.querySelectorAll('.term-card'));
            const norm = (t) => (t || '').split(' (')[0].trim();
            const latinStart = (s) => /^[A-Za-z]/.test(s || '');
            cards.sort((a, b) => {
                const ta = norm(a.querySelector('h2')?.textContent);
                const tb = norm(b.querySelector('h2')?.textContent);
                const la = latinStart(ta);
                const lb = latinStart(tb);
                if (la !== lb) return la ? 1 : -1;
                return ta.localeCompare(tb, 'ru', { sensitivity: 'base' });
            });
            cards.forEach((c) => termsContainer.appendChild(c));
        }

        const termCards = document.querySelectorAll('.term-card');

        // 1) Render tags (badges) under term title (optional)
        termCards.forEach(card => {
            const tagsRaw = (card.dataset.tags || '').trim();
            if (!tagsRaw) return;
            const h2 = card.querySelector('h2');
            if (!h2) return;
            const tags = tagsRaw.split(',').map(s => s.trim()).filter(Boolean);
            if (!tags.length) return;

            const wrap = document.createElement('div');
            wrap.className = 'term-badges';
            tags.forEach(t => {
                const chip = document.createElement('span');
                chip.className = 'term-badge';
                chip.textContent = t;
                wrap.appendChild(chip);
            });
            h2.insertAdjacentElement('afterend', wrap);
        });

        // 2) Remove "Типичная ошибка" section from UI (title + content)
        termCards.forEach(card => {
            const sections = Array.from(card.querySelectorAll('.term-section'));
            sections.forEach(sec => {
                const title = sec.querySelector('.term-section-title');
                if (!title) return;
                if (title.textContent.trim() === 'Типичная ошибка') {
                    sec.remove();
                }
            });
        });

        // 3) Related terms: canonical slugs only + validation + click-to-search + scroll
        const slugToCard = new Map();
        const slugToTitle = new Map();
        const slugs = new Set();

        Array.from(termCards).forEach(card => {
            const slug = (card.dataset.term || '').trim();
            if (!slug) return;
            slugs.add(slug);
            slugToCard.set(slug, card);
            const title = (card.querySelector('h2')?.textContent || slug).trim();
            slugToTitle.set(slug, title);
        });

        // Dev-only validator: warn about broken relations in data
        Array.from(termCards).forEach(card => {
            const from = (card.dataset.term || '').trim();
            const raw = (card.dataset.relatedTerms || '').trim();
            if (!from || !raw) return;
            raw.split(',').map(s => s.trim()).filter(Boolean).forEach(to => {
                if (!slugs.has(to)) {
                    console.warn(`[Glossary] Missing related term: from=\"${from}\" to=\"${to}\"`);
                }
            });
        });

        // Render related chips from slug list (ignore legacy free text)
        Array.from(termCards).forEach(card => {
            const sections = Array.from(card.querySelectorAll('.term-section'));
            const rel = sections.find(sec => (sec.querySelector('.term-section-title')?.textContent || '').trim() === 'Связанные темы');
            if (!rel) return;
            rel.classList.add('term-section--related');
            const titleEl = rel.querySelector('.term-section-title');
            if (titleEl) titleEl.remove(); // chips-only UI (no label)

            const content = rel.querySelector('.term-section-content');
            if (!content) return;

            const raw = (card.dataset.relatedTerms || '').trim();
            const related = raw ? raw.split(',').map(s => s.trim()).filter(Boolean) : [];
            const existing = related.filter(slug => slugs.has(slug));
            if (!existing.length) {
                rel.remove();
                return;
            }

            const wrap = document.createElement('div');
            wrap.className = 'term-related';

            existing.forEach(slug => {
                const label = slugToTitle.get(slug);
                if (!label) return;

                const chip = document.createElement('span');
                chip.className = 'term-related-chip';
                chip.textContent = label;
                chip.addEventListener('click', () => {
                    // 1) Put the term title into search input (so it always matches)
                    searchInput.value = label;
                    searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                    searchInput.focus();

                    // 2) Scroll to the term card (if visible in current filter)
                    requestAnimationFrame(() => {
                        const target = slugToCard.get(slug);
                        if (!target) return;
                        if (target.classList.contains('hidden')) return;
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    });
                });
                wrap.appendChild(chip);
            });

            content.textContent = '';
            content.appendChild(wrap);
        });

        searchInput.addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase().trim();
            
            termCards.forEach(card => {
                const termText = card.textContent.toLowerCase();
                if (query === '' || termText.includes(query)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        });

        // Handle anchor links (scroll to term when page loads with hash)
        window.addEventListener('load', function() {
            if (window.location.hash) {
                const hash = window.location.hash.substring(1);
                const target = document.getElementById(hash);
                if (target) {
                    setTimeout(() => {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            }
        });
    </script>
</body>
</html>

