# Симулятор — CUPED

**Файл:** `simulators/cuped_simulator/index.html`

## Что делает симулятор

CUPED Simulator генерирует синтетические данные A/B-теста с pre-period ковариатой и показывает, как CUPED снижает дисперсию. Вы задаёте параметры эксперимента — симулятор рассчитывает raw и adjusted оценки, визуализирует variance reduction и выдаёт рекомендацию.

## Как использовать

1. Настройте параметры: размер выборки, эффект, корреляцию pre-post, heavy tail.
2. Нажмите **«Рассчитать»**.
3. Сравните raw и CUPED-adjusted результаты: SE, variance reduction, MDE.
4. Меняйте корреляцию и наблюдайте, как растёт выигрыш.

## Что означают выходы

| Показатель | Что отражает |
|---|---|
| **Raw SE** | Стандартная ошибка без коррекции |
| **CUPED SE** | Стандартная ошибка после ковариатной коррекции |
| **Variance reduction** | % снижения дисперсии (= ρ² теоретически) |
| **MDE before/after** | Минимальный детектируемый эффект до и после CUPED |
| **Рекомендация** | Стоит ли применять CUPED в данной ситуации |

## Три миссии

### Миссия 1: Увидеть силу корреляции

1. Установите N = 10 000, lift = 5%, tail = low.
2. Корреляция = 0.3 → variance reduction ~9%. MDE почти не меняется.
3. Корреляция = 0.7 → variance reduction ~49%. MDE падает на ~30%.
4. Корреляция = 0.9 → variance reduction ~81%. MDE падает вдвое.
5. **Вывод:** корреляция — единственный параметр, определяющий выигрыш CUPED.

### Миссия 2: Когда CUPED бесполезен

1. Установите корреляцию = 0.1.
2. Variance reduction = 1%. MDE практически не меняется.
3. Появляется warning: «Корреляция слишком низкая».
4. **Вывод:** при ρ < 0.2 CUPED не стоит усложнения pipeline.

### Миссия 3: Heavy tail + CUPED

1. Установите per_user, корреляция = 0.6, heavy tail = on.
2. Сравните raw SE с и без heavy tail — SE растёт.
3. CUPED всё ещё помогает, но абсолютный SE выше.
4. **Вывод:** CUPED снижает дисперсию на % пропорционально ρ², но если базовая дисперсия огромна (heavy tail) — абсолютный MDE может оставаться высоким. Нужна комбинация: winsorization + CUPED.

## Связь с лекцией

- Секция 3 (CUPED — интуиция): симулятор визуализирует формулу variance reduction = ρ²
- Секция 7 (таблица решений): рекомендация в симуляторе соответствует правилам таблицы
- Секция 5 (winsorization): heavy tail toggle показывает, почему CUPED недостаточен при тяжёлых хвостах
