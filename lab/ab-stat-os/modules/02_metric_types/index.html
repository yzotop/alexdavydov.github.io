<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Модуль 2. Типы метрик — Статистика A/B-тестирования</title>
    <link rel="stylesheet" href="../../assets/style.css">
</head>
<body>
    <div class="container">
        <div class="breadcrumbs">
            <a href="../../../../courses/index.html">Все курсы</a> /
            <a href="../../index.html">Статистика A/B-тестирования</a> / Модуль 2
        </div>

        <div class="nav-links">
            <a href="./index.html" class="active">Модуль</a>
            <a href="./practice.html">Практика</a>
            <a href="./simulators.html">Симуляторы</a>
        </div>

        <h1>Модуль 2. Типы метрик</h1>

        <!-- Section 1 -->
        <section class="section">
            <h2>1. Зачем классифицировать метрику перед тестом</h2>
            <p>
                Выбор статкритерия зависит от типа метрики. Не от названия, не от бизнес-смысла — от математической структуры.
            </p>
            <p>
                Неверная классификация — самая частая причина невалидных результатов A/B-тестов. Аналитик применяет t-test к ratio-метрике, получает p &lt; 0.05 и принимает решение. А потом эффект не воспроизводится.
            </p>
            <p>
                Прежде чем выбирать тест — определите, что за метрика перед вами.
            </p>
        </section>

        <!-- Section 2 -->
        <section class="section">
            <h2>2. Четыре типа метрик</h2>

            <h3>1. Поюзерная метрика (Per-user)</h3>
            <p>Одно числовое значение на пользователя. Агрегируется как среднее.</p>
            <p><strong>Примеры:</strong> количество заказов на пользователя, GMV per user, число сессий.</p>
            <p><strong>Подход:</strong> t-test / Welch t-test. При heavy tail — bootstrap или winsorization.</p>
            <p><strong>Ключевой вопрос:</strong> распределение симметричное или с тяжёлым хвостом?</p>

            <h3>2. Доля (Proportion / Метрика долей)</h3>
            <p>Каждая единица анализа имеет бинарный исход: 0 или 1. Числитель — подсчёт событий, знаменатель — количество экспозиций. Агрегируется как доля.</p>
            <p><strong>Примеры:</strong> CR (покупки / пользователи), CTR (клики / показы), refund rate (возвраты / заказы), доля активных.</p>
            <p><strong>Подход:</strong> z-test / chi-square / bootstrap. Биномиальная интуиция: каждая экспозиция — испытание Бернулли.</p>
            <p><strong>Ключевой вопрос:</strong> является ли числитель подсчётом бинарных событий знаменателя? Если да — это доля, даже если формально записана как X / Y.</p>
            <div class="callout">
                <p><strong>Почему CTR и refund rate — доля, а не ratio?</strong><br>
                CTR = клики / показы. Каждый показ либо получил клик, либо нет — бинарный исход. Аналогично, refund rate: каждый заказ либо возвращён, либо нет. Числитель — это подсчёт «успехов» в знаменателе, а не другая физическая величина.</p>
            </div>

            <h3>3. Ratio-метрика (Ratio)</h3>
            <p>Отношение двух величин <strong>разной природы</strong>. Числитель (деньги, время) — не подсчёт бинарных событий знаменателя.</p>
            <p><strong>Примеры:</strong> AOV (GMV / заказы), RPM (рекламная выручка / показы), стоимость доставки на заказ.</p>
            <p><strong>Подход:</strong> delta-method, линеаризация, bootstrap отношения.</p>
            <p><strong>Ключевой вопрос:</strong> является ли числитель непрерывной величиной, отличной по природе от знаменателя? Если да — это ratio, и t-test на средних некорректен.</p>
            <div class="callout">
                <p><strong>Почему AOV — ratio, а не доля?</strong><br>
                AOV = GMV / количество заказов. GMV — это сумма денег, а не подсчёт событий. Заказ не «либо стоит X, либо нет» — стоимость варьируется непрерывно. Поэтому здесь нужна delta-method.</p>
            </div>

            <h3>4. Условная метрика (Conditional)</h3>
            <p>Метрика вычисляется только для подмножества, определённого post-treatment поведением.</p>
            <p><strong>Примеры:</strong> ARPPU (выручка среди покупателей), средний чек среди заказавших, конверсия среди увидевших фичу.</p>
            <p><strong>Подход:</strong> двухэтапная процедура, bootstrap с коррекцией, регрессия.</p>
            <p><strong>Ключевой вопрос:</strong> зависит ли состав подвыборки от treatment? Если да — прямое сравнение средних даёт selection bias.</p>
        </section>

        <!-- Section 3 -->
        <section class="section">
            <h2>3. Типичные ошибки</h2>

            <h3>Ratio → t-test</h3>
            <p>
                AOV = GMV / Orders. Аналитик считает среднее AOV по пользователям и применяет t-test. Проблема: у разных пользователей разное число заказов, знаменатель случаен. Нужен delta-method или bootstrap отношения.
            </p>

            <h3>Доля → ratio-подход</h3>
            <p>
                CTR = клики / показы. Аналитик применяет delta-method как для ratio. Работать будет, но избыточно: CTR — это доля (каждый показ → 0/1), достаточно z-test. Ошибка не критична, но усложняет анализ без необходимости.
            </p>

            <h3>Conditional → наивное сравнение</h3>
            <p>
                ARPPU = Revenue / Paying Users. В тесте конверсия в покупку выросла — состав «платящих» изменился. Сравнивать ARPPU между группами некорректно: вы сравниваете разные популяции.
            </p>

            <h3>Heavy tail → стандартный t-test</h3>
            <p>
                Revenue per user. Один пользователь с чеком в 100× среднего. t-test показывает значимость, которая исчезает при повторном запуске. Нужен bootstrap, trimmed mean или winsorization.
            </p>
        </section>

        <!-- Section 4 -->
        <section class="section">
            <h2>4. Чеклист перед выбором теста</h2>
            <ol>
                <li><strong>Единица анализа</strong> — на каком уровне рандомизация? (user / session / cluster)</li>
                <li><strong>Есть ли знаменатель?</strong> — если да, случайный ли он?</li>
                <li><strong>Метрика бинарная?</strong> — 0/1 на пользователя → proportion</li>
                <li><strong>Есть ли условие отбора?</strong> — если подвыборка зависит от treatment → conditional</li>
                <li><strong>Форма распределения</strong> — heavy tail? Нужен ли bootstrap?</li>
            </ol>
        </section>

        <!-- Preview sections -->
        <section class="preview-section">
            <h2>Практика</h2>
            <ul class="preview-list">
                <li>18 коротких задач на классификацию метрик</li>
                <li>Отличаем per-user, доли, ratio и conditional</li>
                <li>Учимся видеть риски: heavy tail, selection bias, нестабильный знаменатель</li>
            </ul>
            <a href="./practice.html" class="nav-card">Открыть практику</a>
        </section>

        <section class="preview-section">
            <h2>Симуляторы</h2>
            <ul class="preview-list">
                <li>Классификатор метрик — определяет тип и рекомендует подход к тестированию</li>
                <li>Карта выбора статкритерия — связывает тип метрики с выбором теста</li>
            </ul>
            <a href="./simulators.html" class="nav-card">Открыть симуляторы</a>
        </section>

        <nav class="module-nav">
            <a href="../01_causality/index.html">← Предыдущий модуль</a>
            <a href="../../index.html">К курсу</a>
            <a href="../03_distributions/index.html">Следующий модуль →</a>
        </nav>
    </div>
</body>
</html>

