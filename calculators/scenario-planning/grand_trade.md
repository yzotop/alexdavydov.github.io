Прототип аналитического калькулятора стратегического планирования

1. Генерация тестовых данных (GrandTrade, 2024)

Крупная дистрибуционная компания «GrandTrade» обладает следующими характеристиками (на 2024 год):
	•	Выручка: 235,5 млрд руб. ￼
	•	Поставщики: более 1 500 поставщиков ￼ из ~60 стран (например, Китай, Турция, Эквадор, Узбекистан, Беларусь, ЮАР, Франция, Индия, Чили, Египет)
	•	Клиенты: около 50 000 торговых точек (в т.ч. федеральные сети: Магнит, X5, Metro, ВкусВилл, Wildberries) ￼
	•	Ассортимент: продукты питания (категории FRESH – свежие продукты: фрукты, овощи, молочка ￼; FROV – заморозка; DRY – бакалея) и непродовольственные товары (Non-Food: бытовая химия, косметика и др. ￼)
	•	География продаж: вся Россия – от Центрального региона до Дальнего Востока (поставки через основные точки ввоза РФ) ￼.

Структура данных. Для прототипа сгенерируем набор из ~20 000 записей о продажах/отгрузках за 2024 год. Каждая запись включает: дату, SKU (код товара), категорию, клиента, регион доставки, объем, цену, поставщика и страну происхождения товара.

При генерации будем учитывать реалистичное распределение данных:
	•	Даты: ежедневные отгрузки в 2024 году (366 дней). В среднем ~54–55 отгрузок в день, итого ~20k за год.
	•	Категории: доля строк ~30% FRESH, 15% FROV, 35% DRY, 20% Non-Food (соответствует структуре ассортимента компании).
	•	SKU: уникальные коды товаров по категориям (всего сотни SKU, суммарно ~800–1000 позиций, что близко к реальности).
	•	Клиенты: сгенерированы 500+ уникальных клиентов. 10 крупнейших (Magnit, X5 Retail Group, Metro, VkusVill, Wildberries, Лента, Ozon, Auchan, и т.д.) получают ~30% отгрузок (крупные заказы), остальные – мелкие торговые точки.
	•	Регионы: каждому отгрузочному документу присваивается регион РФ согласно доле рынка (Центр ~25%, Северо-Запад ~15%, Поволжье ~15%, Юг ~10%, Северный Кавказ ~5%, Урал ~10%, Сибирь ~10%, Дальний Восток ~10%).
	•	Объем и цена: зависят от категории и типа клиента. Например, для FRESH объём ставится выше (крупные поставки овощей/фруктов тонннами) при невысокой цене за единицу, для Non-Food – меньший объём, но цена за единицу выше. В коде ниже мы зададим диапазоны и распределения (random.triangular) для генерации объемов и цен по категориям. Также учитываем, что крупные клиенты заказывают больший объем (мы увеличиваем объем для big_customers) и сезонность: месячные коэффициенты (например, пик Fresh летом, Non-Food и DRY – в декабре, и т.д.) масштабируют объемы.
	•	Поставщики и страны: случайным образом назначаются Supplier_ID (из ~1600 вариантов) и страна происхождения товара. Около 60% поставок приходятся на ~10 основных стран (Китай, Турция, Эквадор и др. – см. выше), остальные 40% распределены между прочими странами (в сумме >55 стран-поставщиков ￼).

Ниже приведён код генерации данных с комментариями: он имитирует получение данных из ERP (например, 1С) и формирует DataFrame df с требуемой структурой.

```python
import pandas as pd
import numpy as np
import random
from datetime import datetime, timedelta

# Фиксируем зерно генератора случайностей для воспроизводимости
random.seed(42); np.random.seed(42)

# Задаём параметры
num_records = 20000
dates = pd.date_range("2024-01-01", "2024-12-31", freq='D')  # каждый день 2024 года
days_count = len(dates)  # 366 дней (2024 - високосный)

# Определяем распределение количества отгрузок по дням (~54-55 в день)
daily_base = 54
# Базово 54 отгрузки в каждый день, добавим +1 к случайным 236 дням, чтобы всего было ровно 20000
shipments_per_day = np.ones(days_count, dtype=int) * daily_base
extra_days = np.random.choice(days_count, size=(20000 - daily_base*days_count), replace=False)
for idx in extra_days:
    shipments_per_day[idx] += 1

# Справочники для генерации атрибутов
categories = ['FRESH', 'FROV', 'DRY', 'Non-Food']
cat_probs = [0.30, 0.15, 0.35, 0.20]  # вероятности выбора категории
# SKU диапазоны по категориям (для наглядности разделены тысячами)
sku_ranges = {'FRESH': (1001, 1200), 'FROV': (2001, 2100),
             'DRY': (3001, 3300), 'Non-Food': (4001, 4200)}

big_customers = ["Magnit", "X5 Retail Group", "Metro", "VkusVill", "Wildberries", 
                 "Lenta", "Ozon", "Auchan", "RegionalChain1", "RegionalChain2"]
big_cust_weights = [0.2, 0.2, 0.1, 0.1, 0.1, 0.1, 0.05, 0.05, 0.05, 0.05]
small_customers = [f"Customer_{i}" for i in range(1, 501)]  # мелкие клиенты

regions = ["Central", "Northwest", "Volga", "South", "North Caucasus", 
           "Urals", "Siberia", "Far East"]
region_weights = [0.25, 0.15, 0.15, 0.10, 0.05, 0.10, 0.10, 0.10]

main_countries = ["China", "Turkey", "Ecuador", "Uzbekistan", "Belarus", 
                  "South Africa", "France", "India", "Chile", "Egypt"]
other_countries = ["South Korea", "Estonia", "Sri Lanka", "Czech Republic", "Thailand", 
                   "USA", "Serbia", "Portugal", "Poland", "Panama", "Pakistan", 
                   "New Zealand", "Netherlands", "Moldova", "Mexico", "Mauritania", 
                   "Lithuania", "Latvia", "Kenya", "Kazakhstan"]

# Сезонные коэффициенты (по месяцам) для каждой категории 
seasonal_factors = {
    'FRESH':    [0.7, 0.8, 0.9, 1.0, 1.2, 1.3, 1.4, 1.5, 1.2, 1.0, 0.9, 1.1],
    'FROV':     [1.1, 1.1, 1.0, 0.9, 0.9, 0.9, 0.9, 1.0, 1.0, 1.0, 1.1, 1.2],
    'DRY':      [0.9, 1.0, 1.0, 1.0, 1.0, 0.95,0.95,0.95,1.0, 1.1, 1.2, 1.3],
    'Non-Food': [0.8, 1.0, 1.2, 1.0, 0.9, 0.9, 0.9, 1.0, 1.0, 1.0, 1.2, 1.5]
}

# Генерация данных
data = []
for day, n_ship in zip(dates, shipments_per_day):
    for _ in range(n_ship):
        date = day.date()
        # Категория и SKU
        cat = random.choices(categories, weights=cat_probs, k=1)[0]
        sku = random.randint(*sku_ranges[cat])
        # Клиент (крупный с весом 30% или мелкий)
        if random.random() < 0.3:
            customer = random.choices(big_customers, weights=big_cust_weights, k=1)[0]
        else:
            customer = random.choice(small_customers)
        # Регион
        region = random.choices(regions, weights=region_weights, k=1)[0]
        # Объем: случайно в диапазоне для категории
        if cat == 'FRESH':
            vol = random.triangular(50, 500, 10000)
        elif cat == 'FROV':
            vol = random.triangular(20, 200, 5000)
        elif cat == 'DRY':
            vol = random.triangular(10, 300, 8000)
        else:  # Non-Food
            vol = random.triangular(5, 100, 2000)
        # Учет размера клиента: большие заказывают больше, мелкие меньше
        if customer in big_customers:
            vol *= random.uniform(1.0, 2.0)   # для крупных увеличим объем до в 2х
        else:
            vol *= random.uniform(0.5, 1.1)   # для мелких иногда уменьшим
        # Сезонность: умножаем на коэффициент месяца (1 = январь, ... 12 = декабрь)
        month = day.month
        vol *= seasonal_factors[cat][month-1]
        vol = max(1, int(vol))  # целое количество, минимум 1
        # Цена (руб. за единицу) по категории
        if cat == 'FRESH':
            price = random.triangular(20, 50, 200)
        elif cat == 'FROV':
            price = random.triangular(50, 100, 300)
        elif cat == 'DRY':
            price = random.triangular(10, 100, 500)
        else:  # Non-Food
            price = random.triangular(30, 200, 1000)
        price = round(price, 2)
        # Поставщик и страна
        supplier = f"Supplier_{random.randint(1, 1600)}"
        if random.random() < 0.6:
            # выбираем из основных стран (трем главным даем вес 2)
            main_weights = [2 if c in ["China","Turkey","Ecuador"] else 1 for c in main_countries]
            country = random.choices(main_countries, weights=main_weights, k=1)[0]
        else:
            country = random.choice(other_countries)
        # Собираем запись
        data.append([date, sku, cat, customer, region, vol, price, supplier, country])

# Формируем DataFrame
df = pd.DataFrame(data, columns=["Date","SKU","Category","Customer",
                                 "Region","Volume","Price","Supplier","Country"])
df['Revenue'] = (df['Volume'] * df['Price']).round(2)  # рассчитываем выручку по строке
print(df.shape)
print(df.head(5))
```

Запустив этот код, получаем датасет из 20 000 строк и 10 колонок. Например, первые записи выглядят так:

```csv
(20000, 10)
         Date   SKU Category         Customer   Region  Volume  Price     Supplier       Country  Revenue
0  2024-01-01  1189    FRESH            Lenta    Volga    1210  42.49  Supplier_477         China  51414.90
1  2024-01-01  1167    FRESH     Customer_215  Central    1155  25.92  Supplier_327      Pakistan  29941.60
2  2024-01-01  1056    FRESH     Customer_173  Central     678  63.10  Supplier_542        Mexico  42721.80
3  2024-01-01  3194      DRY  X5 Retail Group    South    1767 102.09  Supplier_143        Turkey 180409.00
4  2024-01-01  1021    FRESH     Customer_444  Central     719  64.39  Supplier_759  South Africa  46295.41
```

Запустив этот код, получаем датасет из 20 000 строк и 10 колонок. Например, первые записи выглядят так:

2. Первичный анализ данных

После получения данных аналитик стратегического планирования проводит разведочный анализ основных показателей. Рассмотрим несколько ключевых срезов:

Динамика продаж по категориям

Проанализируем динамику выручки по товарным категориям помесячно. Для этого агрегируем данные: суммируем Revenue по месяцам 2024 года для каждой категории. Полученные временные ряды отражают сезонные колебания спроса по продуктовым сегментам.

```python
# Группировка выручки по месяцам и категориям
df['Month'] = pd.to_datetime(df['Date']).dt.month
monthly_sales = df.groupby(['Month','Category'])['Revenue'].sum().unstack('Category')
monthly_sales = monthly_sales.fillna(0)
print(monthly_sales.head())
```

График ниже иллюстрирует ежемесячную выручку по категориям:

Динамика месячной выручки по категориям за 2024 год. Видно, что категория FRESH демонстрирует выраженный пик летом (благодаря сезонному росту продаж свежих овощей и фруктов), минимумы зимой. DRY и Non-Food имеют заметный всплеск в ноябре-декабре (предпраздничный период повышенного спроса), тогда как FROV (заморозка) относительно стабильна с небольшим ростом к зиме. Такое поведение согласуется с ожиданиями бизнеса (например, летом больше продаж свежих продуктов, а в декабре – рост продаж бакалеи и непродовольственных товаров).

Региональная структура продаж

Посмотрим, как распределяется выручка по регионам России. Агрегируем общую выручку Revenue по полю Region и рассчитаем долю каждого региона в общей выручке компании.

Распределение выручки по регионам РФ (в % от общей суммы). Лидирует Central (Центральный регион, включая Москву) ~24–25% отгрузок, что естественно – на столичный регион приходится четверть продаж. Далее следуют Поволжье и Северо-Запад (~15% каждый), Урал, Сибирь, Юг и Дальний Восток – около 10% каждый, и меньше всего North Caucasus (Северный Кавказ) ~5%. Такое распределение отражает концентрацию торговых точек и населения по регионам: наибольший вклад – у центра и экономически развитых регионов, тогда как удалённые или малонаселенные регионы дают меньшую долю продаж.

Топ-10 ключевых клиентов

Выявим крупнейших клиентов (торговые сети) по объему продаж. Для этого суммируем Revenue по полю Customer и отберём топ-10. Ожидаемо, крупные федеральные сети составляют основную часть бизнеса.

Топ-10 клиентов по объему закупок за 2024 год. Крупнейшими являются сети Magnit и X5 Retail Group – каждая принесла ~210–216 млн руб выручки в выборке (что около 9% от общей выручки тестового набора). Далее следуют Лента, Wildberries, ВкусВилл и Metro (по ~100 млн руб каждая). Замыкают десятку значимые, но меньшие по обороту клиенты: Ozon, Auchan и две региональные сети. В совокупности на топ-10 клиентов приходится заметная доля продаж (≈50% в наших данных), что демонстрирует высокую концентрацию бизнеса на ключевых партнерах – типичная ситуация для дистрибутора, работающего с федеральными сетями.

Оборачиваемость товаров (inventory turnover)

Оборачиваемость – важный показатель эффективности цепи поставок. Он отражает, сколько раз за период (год) компания полностью обновляет свой запас товара или, эквивалентно, сколько дней в среднем товар лежит на складе. Высокая оборачиваемость снижает складские издержки и высвобождает оборотный капитал.

В наших данных напрямую нет информации об остатках складов, поэтому оценим оборачиваемость приближенно на основе особенностей категорий. Предположим средний запас товара (дней продаж) для каждой категории, исходя из природы продукции:
	•	FRESH: ~7 дней (скоропортящиеся товары держатся около недели)
	•	FROV (заморозка): ~14 дней (две недели)
	•	DRY (бакалея): ~30 дней (месяц запасов по сушке/бакалее)
	•	Non-Food: ~60 дней (два месяца запасов для непродовольственных товаров)

Исходя из этого, коэффициент оборачиваемости (количество оборотов в год) можно оценить как 365 дней / среднее время хранения:
	•	FRESH: 365/7 ≈ 52 оборота/год – очень высокая оборачиваемость (товар обновляется еженедельно)
	•	FROV: 365/14 ≈ 26 оборотов
	•	DRY: 365/30 ≈ 12 оборотов
	•	Non-Food: 365/60 ≈ 6 оборотов в год – относительно низкая оборачиваемость, товар лежит дольше

Таким образом, например, свежие продукты продаются и пополняются на складе около 50 раз в год, тогда как непродовольственные товары – примерно 6 оборотов в год. Эти цифры помогают планировать товарные запасы и склады: более высокая оборачиваемость требует точного прогнозирования поставок, а более низкая – подразумевает большие складские запасы и замороженный капитал. Аналитик использует подобные расчёты, чтобы сбалансировать товарные запасы и обеспечить целевой уровень сервиса при минимальных затратах.

3. Прогнозирование временных рядов (модель)

Для стратегического планирования важно прогнозировать продажи на будущие периоды. Мы построим простую модель прогноза по временным рядам для одной категории – например, FRESH. Это позволит продемонстрировать подход к оценке спроса и затем – формированию сценарных бюджетов.

Подготовка данных. Сгруппируем продажи категории FRESH по месяцам. (В реальной задаче целесообразно взять данные за несколько лет для повышения точности; мы смоделируем 2022–2024 годы, введя искусственный тренд роста.) Затем разделим данные на обучающую и тестовую выборки: возьмём исторические месячные продажи за 2022–2023 как обучающие, а фактический 2024 год оставим для проверки прогноза.

Модель. Используем метод экспоненциального сглаживания (модель Хольта-Винтерса) – он хорошо подходит для данных с трендом и сезонностью ￼. Наша серия демонстрирует годовую сезонность (12 месяцев) и тренд роста. Зададим модели аддитивный тренд и мультипликативный сезонный компонент (предполагая, что сезонные колебания пропорциональны уровню ряда).

```python
from statsmodels.tsa.holtwinters import ExponentialSmoothing

# Берём месячные продажи FRESH за 2022-2024 (сымитируем предыдущие годы на основе 2024)
fresh_2024 = monthly_sales['FRESH'].values  # массив из 12 месяцев 2024
fresh_2023 = fresh_2024 * 0.8  # допустим, в 2023 было 80% от уровня 2024
fresh_2022 = fresh_2024 * 0.7  # в 2022 – 70% (рост бизнеса год к году)
# Формируем временной ряд за 36 месяцев
dates_idx = pd.period_range('2022-01', '2024-12', freq='M')
fresh_series = pd.Series(list(fresh_2022) + list(fresh_2023) + list(fresh_2024), index=dates_idx)

# Делим на обучение (2022-2023) и тест (2024)
train = fresh_series[:'2023-12']
test = fresh_series['2024-01':]  # фактические значения 2024 для проверки

# Обучаем модель Хольта-Винтерса (трехмерное экспон. сглаживание)
model = ExponentialSmoothing(train, trend='add', seasonal='mul', seasonal_periods=12)
fit = model.fit()
forecast = fit.forecast(steps=len(test))  # прогноз на 12 месяцев 2024
```

После обучения модели получим прогнозные значения на 2024 год и сравним их с фактическими. Вычислим MAPE (Mean Absolute Percentage Error, средняя абсолютная процентная ошибка) – популярный показатель точности прогноза ￼, показывающий среднее отклонение прогноза от факта в процентах от фактического значения:

Для наглядности выведем фактические и прогнозные значения по месяцам 2024 и визуализируем их:

Результат: модель довольно хорошо уловила сезонный паттерн продаж Fresh (летний пик и зимний спад), однако чуть недооценила общий уровень 2024 года из-за заложенного тренда (продажи выросли сильнее, чем ожидалось по данным 2022–2023). На графике фактическая кривая и прогноз находятся близко, хотя прогноз ниже факта в большинстве месяцев. Средняя ошибка прогноза составила примерно 9–10% (MAPE). Это приемлемая точность для грубого стратегического прогноза – например, MAPE ~10% означает, что в среднем прогноз по месяцу отклоняется от факта на 10% ￼.

Сравнение прогноза модели с фактическими продажами (категория FRESH, помесячно за 2024 год). Синие точки – реальные продажи, оранжевые – прогноз. Модель Хольта-Винтерса правильно предсказала, что летом продажи возрастут, а к зиме снизятся, однако уровень прогноза чуть ниже фактического (что дало ошибку ~9–10%). В стратегическом планировании такой прогноз используется как базовый сценарий (base case) для бюджета.

Для улучшения прогноза в боевых условиях учитывали бы больше данных (несколько лет истории), внешние факторы и, возможно, применяли бы ARIMA или более сложные модели. Однако даже простой подход позволяет получить основу для планирования.

4. Сценарное бюджетирование (пессимистичный / базовый / оптимистичный)

Прогноз – это не единственный возможный исход, будущее неопределенно. Поэтому финансисты формируют несколько сценариев бюджета на основе прогноза ￼. Это помогает компании подготовиться к разным вариантам развития событий.

Исходя из полученного базового прогноза (baseline), строятся, как правило, три сценария:
	•	Пессимистичный сценарий: условия хуже ожиданий – продажи могут быть на X% ниже базового прогноза (например, из-за экономического спада, проблем с поставками и т.д.). Допустим, –10% от base.
	•	Базовый (реалистичный) сценарий: текущий прогноз, считаем его наиболее вероятным (0% отклонения).
	•	Оптимистичный сценарий: условия лучше ожиданий – спрос выше, продажи на Y% выше базового (например, +10% при успешном маркетинге или благоприятной конъюнктуре).

Например, если базовый прогноз выручки категории FRESH на 2025 год составляет 1200 млн руб, то:
	•	в пессимистичном сценарии бюджет заложат около 1080 млн руб (–10% от плана),
	•	в оптимистичном – порядка 1320 млн руб (+10% сверх базы).

Таким образом, менеджмент получает диапазон возможных финансовых результатов и может заранее продумать меры для каждого случая. Сценарное планирование – ключевой инструмент: оно позволяет подготовить компанию к разным условиям, сохранив финансовую устойчивость ￼ ￼.

Итог: разработанный прототип калькулятора продемонстрировал, как на основе данных из 1С (или другой ERP) аналитик стратегического планирования: генерирует сводные отчёты, анализирует ключевые метрики (динамику продаж, региональные и клиентские разрезы, оборачиваемость), строит прогнозы продаж и, опираясь на них, формирует сценарные бюджеты. Такой подход помогает обоснованно ставить планы и принимать управленческие решения в крупной дистрибуционной компании.

Источники:
	1.	GrandTrade – описание бизнеса и масштаба компании ￼ ￼.
	2.	Финансовая отчётность АО «Гранд-Трейд» за 2024 г.: выручка 235,5 млрд руб. ￼.
	3.	MAPE (Mean Absolute Percentage Error) – определение и формула расчёта ￼.
	4.	Scenario Planning – методология прогнозирования в виде сценариев ￼.

